!function(){"use strict";function e(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class t{static createIFrame(e){const t=document.createElement("iframe");return t.title="Rocketfuel",t.style.display="none",t.style.backgroundColor="transparent",t.style.border="0",t.style.width="410px",t.src=e,t}static showOverlay(e){if(this.iframe)return void(this.iframe.src=e);this.iframe=this.createIFrame(e);const t=function(){var e=0,t=0,i=0,n=0;let o=document.createElement("div"),r=document.createElement("div");function s(r){(r=r||window.event).preventDefault(),e=i-r.clientX,t=n-r.clientY,i=r.clientX,n=r.clientY,o.style.top=o.offsetTop-t+"px",o.style.left=o.offsetLeft-e+"px"}function a(){document.onmouseup=null,document.onmousemove=null}return o.id="iframeWrapper",r.id="iframeWrapperHeader",o.style.cssText="width: 360px; position: fixed; z-index: 2147483647; top: 10px; right: 55px;",r.style.cssText="padding: 3px;cursor: move;position: absolute;width: 387px;height: 2px;left: 10px;",o.onmousedown=function(e){(e=e||window.event).preventDefault(),i=e.clientX,n=e.clientY,document.onmouseup=a,document.onmousemove=s},o.appendChild(r),o}();this.wrapper=t,this.iframe.style.display="block",this.iframe.style.height="800px",this.iframe.style.border="1px solid #dddddd",this.iframe.style.borderRadius="8px",this.iframe.style.background="#F8F8F8";const i=document.createElement("div");i.id="rkfl-loader-overlay",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="410px",i.style.height="100%",i.style.border="1px solid #dddddd",i.style.borderRadius="8px",i.style.backgroundColor="rgba(255, 255, 255, 1)",i.style.display="flex",i.style.justifyContent="center",i.style.alignItems="center",i.style.zIndex="9998";const n=document.createElement("img");if(n.src="https://ik.imagekit.io/rocketfuel/icons/button-image.png?tr=w-100,h-100,fo-auto",n.alt="Loading",n.style.width="100px",n.style.height="100px",n.style.animation="rkfl-pendulum 1s infinite ease-in-out alternate",n.style.transform="translate(-50%, -50%)",n.style.position="absolute",n.style.top="50%",n.style.left="50%",!document.getElementById("rkfl-spinner-style")){const e=document.createElement("style");e.id="rkfl-spinner-style",e.textContent="\n        @keyframes rkfl-pendulum {\n          0%   { transform: translate(-50%, -50%) rotate(0deg); }\n          50%  { transform: translate(-50%, -50%) rotate(140deg); }\n          100% { transform: translate(-50%, -50%) rotate(0deg); }\n        }\n      ",document.head.appendChild(e)}this.iframe.addEventListener("load",()=>{i.remove()}),i.appendChild(n),t.appendChild(this.iframe),t.appendChild(i),document.body.appendChild(t)}static closeIframe(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.iframe=null,this.wrapper=null}}t.iframe=null,t.wrapper=null;const i={feature:"PAYIN",style:"default",containerStyle:"default",containerId:"default"},n="AGE_VERIFICATION",o={prod:"https://payments.rocketfuel.inc/select-currency",qa:"https://qa-payment.rfdemo.co/select-currency",preprod:"https://preprod-payment.rocketdemo.net/select-currency",sandbox:"https://payments-sandbox.rocketfuelblockchain.com/select-currency"},r={prod:"http://localhost:3000",qa:"https://rocketfuel-ccd.netlify.app",preprod:"http://localhost:3000",sandbox:"http://localhost:3000"},s="sdk-buttons-container",a="CLOSE_MODAL";class l{constructor(e){var t;this.rkflToken=null,this.success_event="rocketfuel_result_ok",this.clientId=e.clientId,this.domain=(t=e.environment,o[t]),this.initialize()}handleMessage(e){const i=e.data;if(i.type===this.success_event&&1===i.paymentCompleted){const e=setTimeout(()=>{t.closeIframe(),null!=e||clearTimeout(e)},5e3)}}initialize(){window.addEventListener("message",this.handleMessage)}openRedirect(t){return e(this,void 0,void 0,function*(){const e=`${this.domain}/${t}`;window.open(e,"_blank")})}openIframe(i){return e(this,void 0,void 0,function*(){const e=`${this.domain}/${i}`;t.showOverlay(e)})}}let d,c;class u{constructor(e,t,i){this.appUrl=r[t],this.clientId=e,this.redirect=i}initialize(){this.redirect?this.openRedirect(`${this.appUrl}?clientId=${this.clientId}`):(t.showOverlay(this.appUrl),this.eventListnerConcodium())}openRedirect(e){window.open(e,"_blank")}eventListnerConcodium(){window.addEventListener("message",i=>e(this,void 0,void 0,function*(){var e,n,o;if("request_concordium"===i.data.type){const e=null===window||void 0===window?void 0:window.concordium;if(e){let t;t=yield e.getMostRecentlySelectedAccount(),t||(t=yield e.connect()),i.source.postMessage({type:"concordium_response",message:t},i.origin)}else i.source.postMessage({type:"concordium_response",message:{error:"Provider not found"}},i.origin)}if("concordium_requestVerifiablePresentation"===i.data.type){const e=null===window||void 0===window?void 0:window.concordium;if(e){const{statement:t,challenge:n}=i.data.payload;e.requestVerifiablePresentation(n,t).then(e=>{i.source.postMessage({type:"concordium_requestVerifiablePresentation_response",message:"verified",data:e},i.origin)}).catch(e=>{i.source.postMessage({type:"concordium_requestVerifiablePresentation_error",error:e},i.origin)})}}"accountDisconnected"===(null===(e=i.data)||void 0===e?void 0:e.eventType)&&(null===(o=null===(n=t.iframe)||void 0===n?void 0:n.contentWindow)||void 0===o||o.postMessage("concordium_disconnected",t.iframe.src))}))}}window.RkflPlugin=class{constructor(e){this.redirect=!1,this.payNowButton=null,this.innerHtmlPay='<img src="https://ik.imagekit.io/rocketfuel/icons/rocketfuel-circular.svg?tr=w-30,h-30,fo-auto,q-50" alt="" style="width: 30px; height:30px;"> Pay with Cryto Currency',this.innerHtmlVerify='<img src="https://ik.imagekit.io/rocketfuel/icons/rocketfuel-circular.svg?tr=w-30,h-30,fo-auto,q-50" alt="" style="width: 30px; height:30px;"> Verification via Rocketfuel',this.innerHtmlPayLoading='<img src="https://ik.imagekit.io/rocketfuel/icons/rocketfuel-circular.svg?tr=w-30,h-30,fo-auto,q-50" alt="" style="width: 30px; height:30px;"> Processing...',this.clientId=e.clientId,this.buttons=0===e.plugins.length?[i]:e.plugins,this.redirect=e.redirect||!1,this.enviornment=e.environment||"prod",this.uuid=""}init(){if(this.buttons.find(e=>e.feature===i.feature)){if(!this.clientId)return void console.error("Client ID is required")}else if(!this.clientId)return void console.error("Client ID is required");this.buttons.forEach(o=>{const r=document.createElement("button");switch(r.style.minWidth="250px",r.style.margin="5px",r.style.padding="8px 16px",r.style.border="1px solid #e0e0e0",r.style.borderRadius="999px",r.style.backgroundColor="white",r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.fontFamily="sans-serif",r.style.fontSize="14px",r.style.color="#1a1a1a",r.style.cursor="pointer",r.style.boxShadow="0 0 0 1px rgba(0,0,0,0.05)",o.feature){case i.feature:r.innerHTML=this.innerHtmlPay,r.disabled=!0,r.style.opacity="0.4",this.payNowButton=r,r.id="#pay";const m=document.getElementById(o.containerId||s);if(!m)return void console.error("Container not found.");r.onclick=()=>e(this,void 0,void 0,function*(){if(!t.iframe)if(this.uuid){this.setLoadingState(!0);try{yield function(t){return e(this,arguments,void 0,function*(e,t=!1,i,n){try{d=new l({clientId:e,environment:n}),t?d.openRedirect(i):d.openIframe(i)}catch(e){console.error("Failed to place order",e)}})}(this.clientId,this.redirect,this.uuid,this.enviornment)}catch(e){console.error("Error during order placement:",e)}finally{this.setLoadingState(!1)}}else console.warn("Cart data is not prepared")}),document.getElementById("#pay")||m.appendChild(r);break;case n:r.innerHTML=this.innerHtmlVerify,r.onclick=()=>this.ageVerification(this.enviornment),r.id="#age";const f=document.getElementById(o.containerId||s);if(!f)return void console.error("Container not found.");a=this.clientId,p=this.enviornment,h=this.redirect,c=new u(a,p,h),document.getElementById("#age")||f.appendChild(r);break;default:return void console.warn(`Unknown button: ${o}`)}var a,p,h}),window.addEventListener("message",this.handleMessage)}prepareOrder(e){this.uuid=e,this.payNowButton&&(this.payNowButton.disabled=!1,this.payNowButton.style.opacity="1")}handleMessage(e){e.data.type===a&&t.closeIframe()}setLoadingState(e){this.payNowButton&&(e?(this.payNowButton.disabled=!0,this.payNowButton.innerHTML=this.innerHtmlPayLoading):(this.payNowButton.disabled=!1,this.payNowButton.innerHTML=this.innerHtmlPay))}ageVerification(e){c.initialize()}}}();
