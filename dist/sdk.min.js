!function(){"use strict";function e(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}c((n=n.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class t{static createIFrame(e){const t=document.createElement("iframe");return t.title="Rocketfuel",t.style.display="none",t.style.backgroundColor="transparent",t.style.border="0",t.style.width="410px",t.src=e,t}static showOverlay(e,t=!1){if(this.iframe)return void(this.iframe.src=e);this.iframe=this.createIFrame(e);const i=function(){var e=0,t=0,i=0,n=0;let o=document.createElement("div"),r=document.createElement("div");function s(r){(r=r||window.event).preventDefault(),e=i-r.clientX,t=n-r.clientY,i=r.clientX,n=r.clientY,o.style.top=o.offsetTop-t+"px",o.style.left=o.offsetLeft-e+"px"}function a(){document.onmouseup=null,document.onmousemove=null}return o.id="iframeWrapper",r.id="iframeWrapperHeader",o.style.cssText="width: 360px; position: fixed; z-index: 2147483647; top: 10px; right: 55px;",r.style.cssText="padding: 3px;cursor: move;position: absolute;width: 387px;height: 2px;left: 10px;",o.onmousedown=function(e){(e=e||window.event).preventDefault(),i=e.clientX,n=e.clientY,document.onmouseup=a,document.onmousemove=s},o.appendChild(r),o}();if(this.wrapper=i,this.iframe.style.display="block",this.iframe.style.height="800px",this.iframe.style.border="1px solid #dddddd",this.iframe.style.borderRadius="8px",t){const e=document.createElement("div");e.innerHTML="&times;",e.style.position="absolute",e.style.top="4px",e.style.right="2px",e.style.fontSize="30px",e.style.cursor="pointer",e.style.zIndex="10000",e.addEventListener("click",()=>{console.log("adding click"),this.wrapper&&(document.body.removeChild(this.wrapper),this.wrapper=null,this.iframe=null)}),i.appendChild(e)}i.appendChild(this.iframe),document.body.appendChild(i)}static closeIframe(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.iframe=null,this.wrapper=null}}t.iframe=null,t.wrapper=null;const i={feature:"PAYIN",style:"default",containerStyle:"default",containerId:"default"},n="AGE_VERIFICATION",o={prod:"https://payments.rocketfuel.inc/select-currency",qa:"https://qa-payment.rfdemo.co/select-currency",preprod:"https://preprod-payment.rocketdemo.net/select-currency",sandbox:"https://payments-sandbox.rocketfuelblockchain.com/select-currency"},r={prod:"http://localhost:3000",qa:"http://localhost:3000",preprod:"http://localhost:3000",sandbox:"http://localhost:3000"},s="sdk-buttons-container",a="CLOSE_MODAL";class c{constructor(e){var t;this.rkflToken=null,this.success_event="rocketfuel_result_ok",this.clientId=e.clientId,this.domain=(t=e.environment,o[t]),this.initialize()}handleMessage(e){const i=e.data;if(i.type===this.success_event&&1===i.paymentCompleted){const e=setTimeout(()=>{t.closeIframe(),null!=e||clearTimeout(e)},5e3)}}initialize(){window.addEventListener("message",this.handleMessage)}openRedirect(t){return e(this,void 0,void 0,function*(){const e=`${this.domain}/${t}`;window.open(e,"_blank")})}openIframe(i){return e(this,void 0,void 0,function*(){const e=`${this.domain}/${i}`;t.showOverlay(e,!0)})}}let l,d;class u{constructor(e,t){this.appUrl=r[t],this.clientId=e}initialize(){t.showOverlay(this.appUrl),this.eventListnerConcodium(),window.addEventListener("message",this.handleMessage)}handleMessage(e){e.data.type===a&&t.closeIframe()}eventListnerConcodium(){window.addEventListener("message",t=>e(this,void 0,void 0,function*(){if("request_concordium"===t.data.type){const e=null===window||void 0===window?void 0:window.concordium;if(e){let i;i=yield e.getMostRecentlySelectedAccount(),i||(i=yield e.connect()),t.source.postMessage({type:"concordium_response",message:i},t.origin)}else t.source.postMessage({type:"concordium_response",message:{error:"Provider not found"}},t.origin)}if("concordium_requestVerifiablePresentation"===t.data.type){const e=null===window||void 0===window?void 0:window.concordium;if(e){const{statement:i,challenge:n}=t.data.payload;e.requestVerifiablePresentation(n,i).then(e=>{t.source.postMessage({type:"concordium_requestVerifiablePresentation_response",message:"verified",data:e},t.origin)}).catch(e=>{t.source.postMessage({type:"concordium_requestVerifiablePresentation_error",error:e},t.origin)})}}}))}}window.RkflPlugin=class{constructor(e){this.redirect=!1,this.payNowButton=null,this.clientId=e.clientId,this.buttons=0===e.plugins.length?[i]:e.plugins,this.redirect=e.redirect||!1,this.enviornment=e.environment||"prod",this.uuid=""}init(){if(this.buttons.find(e=>e.feature===i.feature)){if(!this.clientId)return void console.error("Client ID, Client Secret, and Merchant Id are required")}else if(!this.clientId)return void console.error("Client ID is required");this.buttons.forEach(o=>{const r=document.createElement("button");switch(r.style.minWidth="250px",r.style.margin="5px",r.style.padding="8px 16px",r.style.border="1px solid #e0e0e0",r.style.borderRadius="999px",r.style.backgroundColor="white",r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.fontFamily="sans-serif",r.style.fontSize="14px",r.style.color="#1a1a1a",r.style.cursor="pointer",r.style.boxShadow="0 0 0 1px rgba(0,0,0,0.05)",o.feature){case i.feature:r.innerHTML='<img src="https://ik.imagekit.io/rocketfuel/icons/button-image.png?tr=w-30,h-30,fo-auto,q-50" alt=""> Pay with Cryto Currency',r.disabled=!0,r.style.opacity="0.4",this.payNowButton=r;const h=document.getElementById(o.containerId||s);if(!h)return void console.error("Container not found.");r.onclick=()=>e(this,void 0,void 0,function*(){if(!t.iframe)if(this.uuid){this.setLoadingState(!0);try{yield function(t){return e(this,arguments,void 0,function*(e,t=!1,i,n){try{l=new c({clientId:e,environment:n}),t?l.openRedirect(i):l.openIframe(i)}catch(e){console.error("Failed to place order",e)}})}(this.clientId,this.redirect,this.uuid,this.enviornment)}catch(e){console.error("Error during order placement:",e)}finally{this.setLoadingState(!1)}}else console.warn("Cart data is not prepared")}),h.appendChild(r);break;case n:r.innerHTML='<img src="https://ik.imagekit.io/rocketfuel/icons/button-image.png?tr=w-30,h-30,fo-auto,q-50" alt=""> Verification via Rocketfuel',r.onclick=()=>this.ageVerification(this.enviornment);const m=document.getElementById(o.containerId||s);if(!m)return void console.error("Container not found.");a=this.clientId,p=this.enviornment,d=new u(a,p),m.appendChild(r);break;default:return void console.warn(`Unknown button: ${o}`)}var a,p})}prepareOrder(e){this.uuid=e,this.payNowButton&&(this.payNowButton.disabled=!1,this.payNowButton.style.opacity="1")}setLoadingState(e){this.payNowButton&&(e?(this.payNowButton.disabled=!0,this.payNowButton.innerHTML='<img src="https://ik.imagekit.io/rocketfuel/icons/button-image.png?tr=w-30,h-30,fo-auto,q-50" alt=""> Processing...'):(this.payNowButton.disabled=!1,this.payNowButton.innerHTML='<img src="https://ik.imagekit.io/rocketfuel/icons/button-image.png?tr=w-30,h-30,fo-auto,q-50" alt=""> Pay with Cryto Currency'))}ageVerification(e){d.initialize()}}}();
